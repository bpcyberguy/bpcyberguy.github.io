<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Character: ALPHA</title>
    <link rel="stylesheet" href="../css/base.css" />
    <link rel="stylesheet" href="../css/themes/metathesiophobia.css" id="themeStylesheet" />
</head>
<body class="page">
    <main class="shell">
        <header class="topbar">
            <div class="topbar__left">
                <h1 class="h1">OPERATOR: ALPHA</h1>
                <p class="sub">Classified profile (player-local view).</p>
            </div>
            <div class="topbar__right">
                <a class="btn btn--ghost" href="../home/index.html">Home</a>
            </div>
        </header>

        <section class="grid">
            <div class="tile tile--static">
                <h2 class="h2">Vitals</h2>
                <ul class="list">
                    <li>HP: ___ / ___</li>
                    <li>Flux: ___%</li>
                    <li>Status: Stable</li>
                </ul>
            </div>

            <div class="tile">
                <h2 class="h2">Inventory Slots</h2>
                <form id="characterForm" class="stack">
                    <div class="slots" aria-label="Inventory items">
                        <input type="text" id="slot0" class="slot inventory-input" placeholder="Slot 1" />
                        <input type="text" id="slot1" class="slot inventory-input" placeholder="Slot 2" />
                        <input type="text" id="slot2" class="slot inventory-input" placeholder="Slot 3" />
                        <input type="text" id="slot3" class="slot inventory-input" placeholder="Slot 4" />
                        <input type="text" id="slot4" class="slot inventory-input" placeholder="Slot 5" />
                        <input type="text" id="slot5" class="slot inventory-input" placeholder="Slot 6" />
                        <input type="text" id="slot6" class="slot inventory-input" placeholder="Slot 7" />
                        <input type="text" id="slot7" class="slot inventory-input" placeholder="Slot 8" />
                        <input type="text" id="slot8" class="slot inventory-input" placeholder="Slot 9" />
                        <input type="text" id="slot9" class="slot inventory-input" placeholder="Slot 10" />
                        <input type="text" id="slot10" class="slot inventory-input" placeholder="Slot 11" />
                        <input type="text" id="slot11" class="slot inventory-input" placeholder="Slot 12" />
                    </div>
                    <div>
                        <label class="field">
                            <span class="field__label">Notes</span>
                            <textarea id="notesInput" class="field__input" rows="6" placeholder="Character notes, journal entries, or observations..."></textarea>
                        </label>
                    </div>
                    <div id="saveStatus" class="hint" style="margin-top: 8px;"></div>
                    <button type="button" id="savBtn" class="btn">Save Progress</button>
                </form>
            </div>
        </section>
    </main>

    <script src="../js/auth.js"></script>
    <script src="../js/arg.js"></script>
    <script>
    (() => {
        const CHARACTER_ID = "hailey";
        const sess = window.ConfluxAuth.requireAuthOrRedirect("../index.html");
        if (!sess) return;

        function loadProgress() {
            const saved = window.ConfluxAuth.loadCharacterProgress(CHARACTER_ID);
            if (!saved) return;
            
            if (saved.inventory && Array.isArray(saved.inventory)) {
                saved.inventory.forEach((item, idx) => {
                    const el = document.getElementById(`slot${idx}`);
                    if (el) el.value = item || "";
                });
            }
            if (saved.notes) {
                const notesEl = document.getElementById("notesInput");
                if (notesEl) notesEl.value = saved.notes;
            }
        }

        function saveProgress() {
            const inventory = Array.from({length: 12}, (_, i) => {
                const el = document.getElementById(`slot${i}`);
                return el ? el.value : "";
            });
            const notes = document.getElementById("notesInput")?.value || "";
            
            const ok = window.ConfluxAuth.saveCharacterProgress(CHARACTER_ID, {
                inventory,
                notes
            });
            
            const statusEl = document.getElementById("saveStatus");
            if (ok && statusEl) {
                statusEl.textContent = "âœ“ Progress saved at " + new Date().toLocaleTimeString();
                setTimeout(() => { statusEl.textContent = ""; }, 3000);
            }
        }

        document.getElementById("savBtn")?.addEventListener("click", saveProgress);
        
        // Auto-save on field blur
        document.querySelectorAll(".inventory-input, #notesInput").forEach(el => {
            el.addEventListener("blur", saveProgress);
        });

        loadProgress();
    })();
    </script>
</body>
</html>